@{
    ViewBag.Title = "Appoinment History";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script src="~/lib/jquery/dist/jquery.min.js"></script>




<h2>Create an Appointment</h2>
<div class="form-group" style="display:none;">
  <input id="txtAppId" class="form-control" name="AppId">
</div>
<div class="form-group">
  <label for="Name">Name:</label> <input id="txtName" class="form-control" name="Name">
</div>
<div class="form-group">
  <label for="Email">Email:</label> <input id="txtEmail" class="form-control" name="Email">
</div>
<div class="form-group">
  <label for="PhoneNo">PhoneNo:</label> <input id="txtPhoneNo" class="form-control" name="PhoneNo">
</div>
<div class="form-group">
  <label for="StartDate">StartDate:</label> <input id="txtStartDate" class="form-control" name="StartDate">
</div>
<div class="form-group">
  <label for="EndDate">EndDate:</label> <input id="txtEndDate" class="form-control" name="EndDate">
</div>
<div class="form-group">
  <label for="Date">Date:</label> <input id="txtDate" class="form-control" name="Date">
</div><br>
<div class="text-center panel-body">
  <button id="btnSave" onclick="SaveAppoinment()" type="button" class="btn btn-sm btn-primary">Create New Appointment</button>
</div>

<button onclick="LoadAll()" class="btn btn-primary">Load Appointment</button>
<br>
<h2>Appointment List:</h2>
<table id="tblAppointment" class="table table-sm table-striped table-bordered m-2">
    <thead>
        <tr>
        <th>AppId</th>
        <th>Name</th>
        <th>Email</th>
        <th>PhoneNo</th>
        <th>StartDate</th>
        <th>EndDate</th>
        <th>Date</th>
        <th>Action</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script type="text/javascript">

    
    $(document).ready(function () {

       alert("hi");
       
    });
    function LoadAll() 
    { 
        alert("hi load");
        $.ajax({  
            type: "GET",  
            url: "/AppointmentDtls/GetAppointmentDetails",  
            contentType: "application/json; charset=utf-8",  
            dataType: "json",  
            success: function (data){  

                alert(JSON.stringify(data)); 
                alert(data.appid);
                $.each(data, function (i, item) {  
                $("#tblAppointment tbody").append("<tr>"
                        + "<td>" + item.appId + "</td>"
                        + "<td>" + item.name + "</td>"
                        + "<td>" + item.email + "</td>"
                        + "<td>" + item.phoneNo + "</td>"
                        + "<td>" + item.startDate + "</td>"
                        + "<td>" + item.endDate + "</td>"
                        + "<td>" + item.date + "</td>"
                        + "<td>"
                        + "     <button class='btn-success' onclick='Edit(" + item.appid + ")' style='margin-right:5px;'>Edit</button>"
                        + "     <button class='btn-danger' onclick='Delete(" + item.appid + ")'>Delete</button>"
                        + "</td>"
                        + "</tr>");
                        });
            }, //End of AJAX Success function  

            failure: function (data) {  
                alert(data.responseText);  
            }, //End of AJAX failure function  
            error: function (data) {  
                alert(data.responseText);  
            } //End of AJAX error function  

        });
    }

    function SaveAppoinment() 
    { 
        alert("Save");
            var txtName = $("#txtName");
            var txtEmail = $("#txtEmail");
            var txtPhoneNo = $("#txtPhoneNo");
            var txtStartDate = $("#txtStartDate");
            var txtEndDate = $("#txtEndDate");
            var txtDate = $("#txtDate");
           
            var _appointments = {};
            _appointments.Name = txtName.val();
            _appointments.Email = txtEmail.val();
            _appointments.PhoneNo = txtPhoneNo.val();
            _appointments.StartDate = txtStartDate.val();
            _appointments.EndDate = txtEndDate.val();
            _appointments.Date = txtDate.val();
            alert(_appointments);
            alert("hi load");
        $.ajax({  
            type: "POST",  
            url: "/AppointmentDtls/AddUpdateAppointment",
            data: JSON.stringify(_appointments),
            contentType: "application/json; charset=utf-8",  
            dataType: "json",  
            success: function (data){  

                alert(JSON.stringify(data)); 
                LoadAll();
            }, //End of AJAX Success function  

            failure: function (data) {  
                alert(data.responseText);  
            }, //End of AJAX failure function  
            error: function (data) {  
                alert(data.responseText);  
            } //End of AJAX error function  

        });
        
    }


    

    function Edit(aapId) 
    { 
        alert("Edit");
        if (aapId > 0) {

            $.ajax({  
            type: "GET",  
            url: "/AppointmentDtls/GetAppointment",  
            contentType: "application/json; charset=utf-8",  
            dataType: "json",  
            success: function (data){  

                alert(JSON.stringify(data)); 

                $.each(data, function (i, item) {  
                    $("#txtName").val(item.name);
                    $("#txtEmail").val(item.email);
                    $("#txtPhoneNo").val(item.phoneNo);
                    $("#txtStartDate").val(item.startDate);
                    $("#txtEndDate").val(item.endDate);
                    $("#txtDate").val(item.date);
            }, //End of AJAX Success function  

            failure: function (data) {  
                alert(data.responseText);  
            }, //End of AJAX failure function  
            error: function (data) {  
                alert(data.responseText);  
            } //End of AJAX error function  

        });

       }
    }

     function Delete(aapId) {
         alert("Delete");
        if (aapId > 0) {
            $.ajax({
                type: 'DELETE',
                url: '/AppointmentDtls/DeleteAppointment?appId=' + aapId,
                contentType: "application/json; charset=utf-8",
                dataType: 'json',
                success: function (data) {
                    if ($("#tblAppointment tr").length > 2) {
                            $("#tblAppointment").closest('tr').remove();
                        }
                },
                error: function (ex) {
                    console.log("Error in operation");
                }
            });
        }

    }
    


</script>

